/*
 URI.js v1.1 (c) 2010 Gary Court. License: http://github.com/garycourt/uri-js
*/
if(typeof exports==="undefined")exports={};if(typeof require!=="function")require=function(){return exports};
(function(){function r(){this.errors=[]}function w(a){return a===undefined?"undefined":a===null?"null":Object.prototype.toString.call(a).split(" ").pop().split("]").shift().toLowerCase()}function F(a){for(var b="",c=0,d,g,y;c<a.length;){d=parseInt(a.substr(c+1,2),16);if(d<128){b+=String.fromCharCode(d);c+=3}else if(d>191&&d<224){g=parseInt(a.substr(c+4,2),16);b+=String.fromCharCode((d&31)<<6|g&63);c+=6}else{g=parseInt(a.substr(c+4,2),16);y=parseInt(a.substr(c+7,2),16);b+=String.fromCharCode((d&15)<<
12|(g&63)<<6|y&63);c+=9}}return b}function G(a){for(var b="",c=0,d;c<a.length;){d=parseInt(a.substr(c+1,2),16);if(d<128){d=String.fromCharCode(d);b+=d.match(H)?d:a.substr(c,3);c+=3}else if(d>191&&d<224){b+=a.substr(c,6);c+=6}else{b+=a.substr(c,9);c+=9}}return b}function n(a){a=a.charCodeAt(0);return a<128?"%"+a.toString(16).toUpperCase():a>127&&a<2048?"%"+(a>>6|192).toString(16).toUpperCase()+"%"+(a&63|128).toString(16).toUpperCase():"%"+(a>>12|224).toString(16).toUpperCase()+"%"+(a>>6&63|128).toString(16).toUpperCase()+
"%"+(a&63|128).toString(16).toUpperCase()}function e(a){return"(?:"+a+")"}function h(){for(var a=arguments[0],b=1,c=arguments[b];c;){a=a.slice(0,-1)+c.slice(1);c=arguments[++b]}return a}var j=h("[0-9]","[A-Fa-f]"),p=e("%"+j+j),I=h("[\\:\\/\\?\\#\\[\\]\\@]","[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),i=h("[A-Za-z]","[0-9]","[\\-\\.\\_\\~]"),z=e("[A-Za-z]"+h("[A-Za-z]","[0-9]","[\\+\\-\\.]")+"*"),x=e(e(p+"|"+h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]"))+"*"),k=e(e("25[0-5]")+"|"+e("2[0-4][0-9]")+"|"+
e("1[0-9][0-9]")+"|"+e("[1-9][0-9]")+"|[0-9]");k=e(k+"."+k+"."+k+"."+k);var o=e(h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]")+"+");j=e("v"+j+"+\\."+h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:]")+"+");j=e("\\["+e(o+"|"+j)+"\\]");o=e(e(p+"|"+h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"))+"*");k=e(j+"|"+k+"|"+o);j=e("[0-9]*");o=e(e(x+"@")+"?"+k+e("\\:"+j)+"?");var l=e(p+"|"+h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]","[\\:\\@]")),m=e(l+"*"),q=e(l+"+"),s=e(e(p+"|"+h(i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",
"[\\@]"))+"+");m=e(e("\\/"+m)+"*");var t=e("\\/"+e(q+m)+"?");s=e(s+m);q=e(q+m);var u=e(""),v=e(e(l+"|[\\/\\?]")+"*");l=e(e(l+"|[\\/\\?]")+"*");var J=RegExp("^"+e("("+e(z+"\\:"+e(e("\\/\\/"+o+m)+"|"+t+"|"+q+"|"+u)+e("\\?"+v)+"?"+e("\\#"+l)+"?")+")|("+e(e(e("\\/\\/"+o+m)+"|"+t+"|"+s+"|"+u)+e("\\?"+v)+"?"+e("\\#"+l)+"?")+")")+"$"),K=RegExp("^("+z+")\\:"+e(e("\\/\\/("+e("("+x+")@")+"?("+k+")"+e("\\:("+j+")")+"?)")+"?("+m+"|"+t+"|"+q+"|"+u+")")+e("\\?("+v+")")+"?"+e("\\#("+l+")")+"?$"),L=RegExp("^(){0}"+
e(e("\\/\\/("+e("("+x+")@")+"?("+k+")"+e("\\:("+j+")")+"?)")+"?("+m+"|"+t+"|"+s+"|"+u+")")+e("\\?("+v+")")+"?"+e("\\#("+l+")")+"?$"),M=RegExp(h("[^]","[A-Za-z]","[0-9]","[\\+\\-\\.]"),"g"),N=RegExp(h("[^\\%\\:]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),O=RegExp(h("[^\\%]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),P=RegExp(h("[^\\%\\/\\:\\@]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),Q=RegExp(h("[^\\%\\/\\@]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),A=RegExp(h("[^\\%]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]",
"[\\:\\@\\/\\?]"),"g"),R=RegExp(h("[^]",i,"[\\!\\$\\&\\'\\(\\)\\*\\+\\,\\;\\=]"),"g"),H=RegExp(i,"g");h("[^\\%]",i,I);var B=RegExp(p+"+","g"),S=/^(?:([^:\/?#]+):)?(?:\/\/((?:([^\/?#@]*)@)?([^\/?#:]*)(?:\:(\d*))?))?([^?#]*)(?:\?([^#]*))?(?:#(.*))?/i,C=/^\.\.?\//,D=/^\/\.(\/|$)/,E=/^\/\.\.(\/|$)/,T=/^\/?.*?(?=\/|$)/,U="".match(/(){0}/)[1]===undefined,f={};r.prototype={scheme:undefined,authority:undefined,userinfo:undefined,host:undefined,port:undefined,path:undefined,query:undefined,fragment:undefined,
reference:undefined,errors:undefined};f.b={};f.parse=function(a,b){var c,d=new r;a=a?a.toString():"";b=b||{};if(b.reference==="suffix")a=(b.scheme?b.scheme+":":"")+"//"+a;if(c=a.match(J))c=c[1]?a.match(K):a.match(L);if(!c){b.tolerant||d.errors.push("URI is not strictly valid.");c=a.match(S)}if(c){if(U){d.scheme=c[1];d.authority=c[2];d.userinfo=c[3];d.host=c[4];d.port=parseInt(c[5],10);d.path=c[6]||"";d.query=c[7];d.fragment=c[8];if(isNaN(d.port))d.port=c[5]}else{d.scheme=c[1]||undefined;d.authority=
a.indexOf("//")!==-1?c[2]:undefined;d.userinfo=a.indexOf("@")!==-1?c[3]:undefined;d.host=a.indexOf("//")!==-1?c[4]:undefined;d.port=parseInt(c[5],10);d.path=c[6]||"";d.query=a.indexOf("?")!==-1?c[7]:undefined;d.fragment=a.indexOf("#")!==-1?c[8]:undefined;if(isNaN(d.port))d.port=a.match(/\/\/.*\:(?:\/|\?|\#|$)/)?c[4]:undefined}d.reference=!d.scheme&&!d.authority&&!d.path&&!d.query?"same-document":d.scheme?d.fragment?"uri":"absolute":"relative";b.reference&&b.reference!=="suffix"&&b.reference!==d.reference&&
d.errors.push("URI is not a "+b.reference+" reference.");(c=f.b[d.scheme||b.scheme])&&c.parse&&c.parse(d,b)}else d.errors.push("URI can not be parsed.");return d};f.d=function(a){var b=[];if(a.userinfo!==undefined||a.host!==undefined||typeof a.port==="number"){if(a.userinfo!==undefined){b.push(a.userinfo.toString().replace(N,n));b.push("@")}a.host!==undefined&&b.push(a.host.toString().toLowerCase().replace(O,n));if(typeof a.port==="number"){b.push(":");b.push(a.port.toString(10))}}return b.length?
b.join(""):undefined};f.a=function(a){for(var b=[],c;a.length;)if(a.match(C))a=a.replace(C,"");else if(a.match(D))a=a.replace(D,"/");else if(a.match(E)){a=a.replace(E,"/");b.pop()}else if(a==="."||a==="..")a="";else{c=a.match(T)[0];a=a.slice(c.length);b.push(c)}return b.join("")};f.serialize=function(a,b){var c=[],d;b=b||{};(d=f.b[a.scheme||b.scheme])&&d.serialize&&d.serialize(a,b);if(b.reference!=="suffix"&&a.scheme){c.push(a.scheme.toString().toLowerCase().replace(M,""));c.push(":")}a.authority=
f.d(a);if(a.authority!==undefined){b.reference!=="suffix"&&c.push("//");c.push(a.authority);a.path&&a.path.charAt(0)!=="/"&&c.push("/")}if(a.path){d=f.a(a.path.toString().replace(/%2E/ig,"."));d=a.scheme?d.replace(P,n):d.replace(Q,n);if(a.authority===undefined)d=d.replace(/^\/\//,"/%2F");c.push(d)}if(a.query){c.push("?");c.push(a.query.toString().replace(A,n))}if(a.fragment){c.push("#");c.push(a.fragment.toString().replace(A,n))}return c.join("").replace(B,G).replace(/%[0-9A-Fa-f]{2}/g,function(g){return g.toUpperCase()})};
f.c=function(a,b,c,d){var g=new r;if(!d){a=f.parse(f.serialize(a,c),c);b=f.parse(f.serialize(b,c),c)}c=c||{};if(!c.tolerant&&b.scheme){g.scheme=b.scheme;g.authority=b.authority;g.userinfo=b.userinfo;g.host=b.host;g.port=b.port;g.path=f.a(b.path);g.query=b.query}else{if(b.authority!==undefined){g.authority=b.authority;g.userinfo=b.userinfo;g.host=b.host;g.port=b.port;g.path=f.a(b.path);g.query=b.query}else{if(b.path){if(b.path.charAt(0)==="/")g.path=f.a(b.path);else{g.path=a.authority!==undefined&&
!a.path?"/"+b.path:a.path?a.path.slice(0,a.path.lastIndexOf("/")+1)+b.path:b.path;g.path=f.a(g.path)}g.query=b.query}else{g.path=a.path;g.query=b.query!==undefined?b.query:a.query}g.authority=a.authority;g.userinfo=a.userinfo;g.host=a.host;g.port=a.port}g.scheme=a.scheme}g.fragment=b.fragment;return g};f.g=function(a,b,c){return f.serialize(f.c(f.parse(a,c),f.parse(b,c),c,true),c)};f.normalize=function(a,b){if(typeof a==="string")return f.serialize(f.parse(a,b),b);else if(w(a)==="object")return f.parse(f.serialize(a,
b),b);return a};f.e=function(a,b,c){if(typeof a==="string")a=f.serialize(f.parse(a,c),c);else if(w(a)==="object")a=f.serialize(a,c);if(typeof b==="string")b=f.serialize(f.parse(b,c),c);else if(w(b)==="object")b=f.serialize(b,c);return a===b};f.f=function(a){return a&&a.toString().replace(R,n)};f.h=function(a){return a&&a.toString().replace(B,F)};exports.Components=r;exports.i=f;exports.URI={SCHEMES:f.b,parse:f.parse,removeDotSegments:f.a,serialize:f.serialize,resolveComponents:f.c,resolve:f.g,normalize:f.normalize,
equal:f.e,escapeComponent:f.f,unescapeComponent:f.h}})();
